<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title><%= htmlWebpackPlugin.options.title %></title>
</head>
<body>
<div id="preloader">
    <section class="section section-preloader">
        <div class="greeting">
            <a href="#" class="logo">
                <i class="icon icon_logo"></i>
                <span class="logo__text">Art &amp; Data Studio</span>
            </a>
            <h4 class="section__subtitle">
                <span class="text_medium">Приветствуем</span>
                <span>Команда готова реализовать ваши планы</span>
            </h4>
        </div>
        <div class="booting-info">
            <h4 class="section__subtitle">
                <span class="section__subtitle_percent-number">0</span>
                <span class="section__subtitle_measur-units">%</span>
            </h4>
            <h4 class="section__subtitle">
                <span class="text_medium">Загрузка проектов</span>
                <span>Подождите, осталось немного</span>
            </h4>
        </div>
    </section>
</div>
<div id="content-overlay"></div>
<div class="grid">
    <div class="grid__col">
        <div class="grow-item grow-item-left"></div>
        <div class="grow-item grow-item-right"></div>
    </div>
    <div class="grid__col">
        <div class="grow-item grow-item-left"></div>
        <div class="booting-indicator touch-only"></div>
        <div class="grow-item grow-item-right"></div>
    </div>
    <div class="grid__col">
        <div class="grow-item grow-item-left touch-only"></div>
        <div class="booting-indicator"></div>
        <div class="grow-item grow-item-right touch-only"></div>
    </div>
    <div class="grid__col">
        <div class="grow-item grow-item-left"></div>
        <div class="grow-item grow-item-right"></div>
    </div>
    <div class="grid__col">
        <div class="grow-item grow-item-left"></div>
        <div class="grow-item grow-item-right"></div>
    </div>
    <div class="grid__col">
        <div class="grow-item grow-item-left"></div>
        <div class="grow-item grow-item-right"></div>
    </div>
</div>
<script type="text/javascript">
    var percents = 0;
    var indicators = document.getElementsByClassName("booting-indicator");
    var grid = document.getElementsByClassName("grid__col");
    var label = document.getElementsByClassName("section__subtitle_percent-number")[0];
    var timer;

    // emitted form PreLoaded component
    window.onBundleLoaded = function () {
        // now control take CSS
        clearTimeout(timer);
        increase = undefined;
        // need some delay for styles
        setTimeout(function () {
            for (var gridItem of grid) {
                gridItem.classList.add("loaded");

                const innerItems = gridItem.getElementsByTagName("div");
                for (var item of innerItems) {
                    item.removeAttribute("style");
                }
            }
        }, 100);

        // at the last stage it is necessary to increase percents to 100
        var counter = 0;
        (function ending() {
            setTimeout(function () {
                // searching current visible indicator
                for (var indicator of indicators) {
                    var height = parseInt(indicator.getBoundingClientRect().height);
                    if (!height) {
                        continue;
                    }
                    label.innerHTML = Math.floor(height / window.innerHeight * 100);
                    counter++;
                }
                // HIDE_TIMEOUT from PreLoader component divide by 50 ms
                (counter < 40) && ending();
            }, 50)
        })();
    }

    function increase() {
        timer = setTimeout(function () {
            percents++;
            label.innerHTML = percents;
            // set height to all indicators
            for (var item of grid) {
                const growItems = item.getElementsByClassName("grow-item");
                for (var growItem of growItems) {
                    growItem.style.height = (100 - percents) + "%";
                }
            }

            for (var indicator of indicators) {
                indicator.style.height = percents + "%";
            }
            increase && (percents < 85) && increase();

        }, percents * (percents / 5));
    }

    increase();
</script>
</body>
</html>